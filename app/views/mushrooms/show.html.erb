<% content_for :title, "Showing mushroom" %>
<div class="md:w-full w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <h1 class="font-bold text-4xl">Showing mushroom</h1>

  <%= render @mushroom %>

  <!-- Characters, grouped by part -->
  <% character_rows = @mushroom.mr_character_mushrooms.includes(mr_character: [:part, :display_option]).order('parts.name ASC, mr_characters.name ASC') %>
  <% grouped = character_rows.group_by { |rc| rc.mr_character&.part&.name || "Other" } %>

  <div class="mt-6 space-y-4">
    <% grouped.each do |part_name, rows| %>
      <details class="bg-white border rounded-md p-4" open>
        <summary class="font-semibold cursor-pointer"><%= part_name %> (<%= rows.size %>)</summary>
        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <% rows.each do |rc| %>
            <% c = rc.mr_character %>
            <div class="flex items-center justify-between border rounded p-2">
              <div>
                <div class="text-sm text-gray-500"><%= c&.name %></div>
                <div class="font-medium">
                  <% if c&.display_option_id == 6 %>
                    <% color_id = rc.character_value.to_i %>
                    <span class="inline-flex items-center">
                      <%= image_tag "AMS_colors/banner_50x50/banner_#{color_id}.jpg", alt: "Color #{color_id}", class: "w-6 h-6 mr-2 rounded border" %>
                      <span>Color ID: <%= color_id %></span>
                    </span>
                  <% else %>
                    <%= rc.character_value %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </details>
    <% end %>
  </div>

  <div class="flex flex-col gap-2">
  <%= link_to "Back to mushrooms", mushrooms_path, class: "w-full text-center rounded-md px-3.5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white font-medium" %>
  </div>
    </div>
