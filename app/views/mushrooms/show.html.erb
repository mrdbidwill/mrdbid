<% content_for :title, "Showing mushroom" %>
<p> app/views/mushrooms/show.html.erb> </p>
<div class="md:w-2/3 w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <h1 class="font-bold text-4xl">Showing mushroom</h1>

  <%= render @mushroom %>

  <!-- Characters, grouped by part -->
  <% character_rows = @mushroom.mr_character_mushrooms.includes(mr_character: [:part, :display_option]).order('parts.name ASC, mr_characters.name ASC') %>
  <% grouped = character_rows.group_by { |rc| rc.mr_character&.part&.name || "Other" } %>

  <div class="mt-6 space-y-4">
    <% grouped.each do |part_name, rows| %>
      <details class="bg-white border rounded-md p-4" open>
        <summary class="font-semibold cursor-pointer"><%= part_name %> (<%= rows.size %>)</summary>
        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-3">
          <% rows.each do |rc| %>
            <% c = rc.mr_character %>
            <div class="flex items-center justify-between border rounded p-2">
              <div>
                <div class="text-sm text-gray-500"><%= c&.name %></div>
                <div class="font-medium">
                  <% if c&.display_option_id == 6 %>
                    <% color_id = rc.character_value.to_i %>
                    <span class="inline-flex items-center">
                      <%= image_tag "AMS_colors/banner_50x50/banner_#{color_id}.jpg", alt: "Color #{color_id}", class: "w-6 h-6 mr-2 rounded border" %>
                      <span>Color ID: <%= color_id %></span>
                    </span>
                  <% else %>
                    <%= rc.character_value %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </details>
    <% end %>
  </div>

  <% if defined?(policy) && policy(@mushroom).edit? %>
    <%= link_to "Edit this mushroom", edit_mushroom_path(@mushroom), class: "w-full sm:w-auto text-center rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium mt-6" %>
  <% end %>

  <%= link_to "Back to mushrooms", mushrooms_path, class: "w-full sm:w-auto text-center mt-2 sm:mt-0 sm:ml-2 rounded-md px-3.5 py-2.5 bg-gray-100 hover:bg-gray-50 inline-block font-medium" %>

  <% if defined?(policy) && policy(@mushroom).destroy? %>
    <%= button_to "Destroy this mushroom", @mushroom, method: :delete, form_class: "sm:inline-block mt-2 sm:mt-0 sm:ml-2", class: "w-full rounded-md px-3.5 py-2.5 text-white bg-red-600 hover:bg-red-500 font-medium cursor-pointer", data: { turbo_confirm: "Are you sure?" } %>
  <% end %>

    </div>
