<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preload" href="<%= asset_path('application.css') %>" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="<%= asset_path('application.css') %>"></noscript>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true %>

    <style>
        html{visibility:visible}
        body{margin:0}
    </style>

    <title><%= content_for(:title) || "MRDBID" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <%# Ignore the warning for favicons and app in next 6 lines  %>
    <link rel="icon" href="<%= asset_path('favicon-32x32.png') %>" type="image/png">
    <link rel="apple-touch-icon" href="<%= asset_path('favicon-16x16.png') %>" type="image/png">
  </head>

  <body class="bg-gray-100 text-gray-800">
  <%= render 'shared/menu' %>

  <%# Dev/Test view origin banner %>
  <% if Rails.env.development? || Rails.env.test? %>
    <div class="w-full bg-yellow-50 text-yellow-800 text-xs px-3 py-1 border-b border-yellow-200">
      <span class="font-semibold">View:</span>
      <%= @view_debug_identifier.presence || "#{controller.controller_path}##{action_name}" %>
    </div>
  <% end %>


  <%# Visible list of all rendered templates/partials, scoped to the current view's directory %>
  <% if Rails.env.development? || Rails.env.test? %>
    <% current_dir =
         if @view_debug_identifier.present?
           File.dirname(@view_debug_identifier) # e.g., "app/views/mushrooms"
         else
           "app/views/#{controller.controller_path}" # fallback, e.g., "app/views/mushrooms"
         end %>

    <% # Start with the main template if it belongs to this directory %>
    <% items = [] %>
    <% if @view_debug_identifier.present? && @view_debug_identifier.start_with?("#{current_dir}/") %>
      <% items << @view_debug_identifier %>
    <% end %>

    <% # Add ONLY partials rendered from this directory %>
    <% partials = Array(Thread.current[:rendered_partials]).uniq.select { |p| p.start_with?("#{current_dir}/") } %>
    <% items.concat(partials) %>

    <div class="w-full bg-yellow-50 text-yellow-800 text-xs px-3 py-1 border-b border-yellow-200">
      <span class="font-semibold">Rendered views:</span>
      <% items.each do |path| %>
        <span class="ml-2 inline-block px-1.5 py-0.5 bg-yellow-100 border border-yellow-200 rounded"><%= path %></span>
      <% end %>
    </div>
  <% end %>



  <%#= <main class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 py-1"> %>
  <%#= <main class="min-h-screen mx-auto pl-10 pr-4 pt-2 pb-32 md:pb-16"> %>
  <main class="min-h-screen container mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-32 md:pb-16">

    <% if flash[:alert].present? %>
      <div class="bg-red-50 border border-red-200 text-red-700 font-bold text-lg md:text-xl px-4 py-3 rounded mb-4">
        <%= flash[:alert] %>
      </div>
    <% end %>
    <% if flash[:notice].present? %>
      <div class="bg-emerald-50 border border-emerald-200 text-emerald-700 font-semibold px-4 py-3 rounded mb-4">
        <%= flash[:notice] %>
      </div>
    <% end %>

      <%= yield %>
    </main>
  </body>
</html>