<% content_for :title, "Source data" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-1 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <!-- Filter card -->
  <div class="group-box mb-6">
    <div class="group-header">
      Filter Source Data by Type
      <p class="hint mt-1">Select a source type to view and edit its source data.</p>
    </div>
    <div class="px-4 py-4">
      <%= form_with url: admin_source_data_path, method: :get, local: true, class: "grid grid-cols-1 gap-4" do |form| %>
        <div class="form-field">
          <%= form.label :source_data_type_id, "Source Data Type", class: "form-label" %>
          <%= form.select :source_data_type_id,
                          @source_data_types,
                          { include_blank: "Select a type..." },
                          class: "form-input",
                          style: "width: 70%; padding: 0.5rem; box-shadow: 0 0 0 1px rgba(0,0,0,0.06), 0 0 10px 2px rgba(0,0,0,0.12), 0 0 24px 6px rgba(0,0,0,0.12);" %>
          <p class="form-help">Select a source type to filter source data.</p>
        </div>

        <div class="flex gap-2">
          <%= form.submit "Apply Filter", class: "btn-primary" %>
          <%= link_to "Reset", admin_source_data_path, class: "btn" %>
        </div>
      <% end %>
    </div>

    <!-- Current filter summary -->
    <div class="well">
      <% if params[:source_data_type_id].present? %>
        <div class="flex flex-wrap items-center gap-2 text-sm">
          <span class="text-gray-700 font-medium">Currently showing:</span>
          <span class="inline-flex items-center gap-1 rounded-full bg-green-50 text-green-700 px-2.5 py-1">
            <span class="font-medium">Type:</span>
            <span><%= SourceDataType.find_by(id: params[:source_data_type_id])&.name %></span>
          </span>
          <%= link_to "Change", "#", class: "ml-auto text-blue-700 hover:underline", onclick: "document.querySelector('form[action=\"#{admin_source_data_path}\"]').scrollIntoView({behavior:'smooth'})" %>
        </div>
      <% else %>
        <p class="muted">No type selected. Please choose one above.</p>
      <% end %>
    </div>
  </div>
  <!-- End Filter card -->

  <% if params[:source_data_type_id].present? %>
    <div class="flex justify-between items-center">
      <h1 class="font-bold text-2xl">Source Data</h1>

      <%= link_to "Back to Admin Dashboard", admin_root_path, class: "rounded-md px-2 py-1 bg-gray-600 hover:bg-gray-500 text-white block font-medium" %>
      <%= link_to "New Source Data", new_admin_source_datum_path, class: "rounded-md px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white block font-medium" %>
    </div>

    <div id="source_data" class="min-w-full divide-y divide-gray-100 space-y-2 mt-4">
      <% if @source_data.any? %>
        <% @source_data.each do |source_datum| %>
          <div class="flex items-start gap-3">
            <div class="flex-1">
              <%= render source_datum %>
            </div>
            <div class="shrink-0">
              <%= link_to "Show", admin_source_datum_path(source_datum), class: "btn-primary text-xs px-2 py-1" %>
              <%= link_to "Edit", edit_admin_source_datum_path(source_datum, source_data_type_id: params[:source_data_type_id]), class: "btn-primary text-xs px-2 py-1" %>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="text-center my-10 text-2xl text-red-600">No source data found for this type.</p>
      <% end %>
    </div>
  <% else %>
    <div class="text-center my-10">
      <p class="text-xl text-gray-600">Please select a source data type from the dropdown above to view and edit source data.</p>
    </div>
  <% end %>
</div>
