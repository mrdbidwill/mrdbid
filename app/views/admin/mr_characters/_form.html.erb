<%= form_with(model: [:admin, mr_character], class: "contents") do |form| %>
  <% if mr_character.errors.any? %>
    <div id="error_explanation" class="bg-red-50 text-red-500 px-2 py-1 font-medium rounded-md mt-3">
      <h2><%= pluralize(mr_character.errors.count, "error") %> prohibited this Mushroom Character from being saved:</h2>

      <ul class="list-disc ml-6">
        <% mr_character.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Top action bar -->
  <div class="mb-4 flex flex-wrap items-center gap-1">
    <%= form.submit(
          mr_character.persisted? ? "Update Mushroom Character" : "Create Mushroom Character",
          class: "rounded-md px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer"
        ) %>
    <%= link_to "Show this character", admin_mr_character_path(mr_character),
                class: "rounded-md px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" if mr_character.persisted? %>
    <%= link_to "Back to characters", admin_mr_characters_path,
                class: "rounded-md px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer" %>
  </div>

  <% unless mr_character.name.to_s == "id" %>
    <div class="my-5">
    <%= form.label :name, "Name" %>
    <%= form.text_field :name, class: ["block shadow-md rounded-md border px-3 py-1 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": mr_character.errors[:name].none?, "border-red-400 focus:outline-red-600": mr_character.errors[:name].any?}] %>
  </div>
    <% end %>

  <div class="my-5">
    <%= form.label :description %>
    <%= form.text_area :description, rows: 4, class: ["block shadow-sm rounded-md border px-3 py-1 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": mr_character.errors[:description].none?, "border-red-400 focus:outline-red-600": mr_character.errors[:description].any?}] %>
  </div>

  <div class="my-1">
    <%= form.label :comments %>
    <%= form.text_area :comments, rows: 4, class: ["block shadow-sm rounded-md border px-2 py-1 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": mr_character.errors[:comments].none?, "border-red-400 focus:outline-red-600": mr_character.errors[:comments].any?}] %>
  </div>

  <div class="my-5">
    <%= form.label :fungus_type_id, "Fungus Type" %>
    <p class="text-sm text-gray-600 mb-2">
      Leave blank for universal characters that apply to all fungus types.
    </p>
    <%= form.select :fungus_type_id,
                    FungusType.order(:name).pluck(:name, :id),
                    { include_blank: "Universal (applies to all types)" },
                    class: "block shadow-md rounded-md border border-gray-400 px-3 py-2 mt-2 w-full focus:outline-blue-600" %>
  </div>

  <div class="my-1">
  <%= form.label :part_id, "Part" %>
  <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
    <%= form.collection_radio_buttons :part_id, Part.order(:name), :id, :name do |b| %>
      <label class="flex items-center gap-2 p-2 rounded border cursor-pointer hover:bg-gray-50">
        <%= b.radio_button(class: "text-blue-600 focus:ring-blue-600") %>
        <span><%= b.text %></span>
      </label>
    <% end %>
  </div>
  </div>


  <div class="my-5">
    <%= form.label :observation_method_id, "Observation Method" %>
    <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
      <%= form.collection_radio_buttons :observation_method_id, ObservationMethod.order(:name), :id, :name do |b| %>
        <label class="flex items-center gap-2 p-2 rounded border cursor-pointer hover:bg-gray-50">
          <%= b.radio_button(class: "text-blue-600 focus:ring-blue-600") %>
          <span><%= b.text %></span>
        </label>
      <% end %>
    </div>
  </div>


    <div class="my-5">
      <%= form.label :display_option_id, "Display Option" %>
      <div class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2">
        <%= form.collection_radio_buttons :display_option_id, DisplayOption.order(:name), :id, :name do |b| %>
          <label class="flex items-center gap-2 p-2 rounded border cursor-pointer hover:bg-gray-50">
            <%= b.radio_button(class: "text-blue-600 focus:ring-blue-600") %>
            <span><%= b.text %></span>
          </label>
        <% end %>
      </div>
    </div>


      <div class="my-5">
        <%= form.label :source_data_id, "Source Data" %>
        <p class="text-sm text-gray-600 mb-2">
          Type to search existing sources.
          <%= link_to "View all sources", admin_source_data_path, target: "_blank", class: "text-blue-600 hover:underline font-medium" %> |
          <%= link_to "Create new source", new_admin_source_datum_path, target: "_blank", class: "text-blue-600 hover:underline font-medium" %>
        </p>
        <% current_source = mr_character.source_data %>
        <% sources_json = SourceData.order(:title).map { |sd| { id: sd.id, title: sd.title } }.to_json %>
        <div data-controller="source-data-autocomplete"
             data-source-data-autocomplete-sources-value='<%= sources_json %>'
             class="relative">
          <%= form.text_field :source_data_title,
                              value: current_source&.title,
                              placeholder: "Start typing to search sources...",
                              class: "block shadow-md rounded-md border border-gray-400 px-3 py-2 mt-2 w-full focus:outline-blue-600",
                              data: {
                                source_data_autocomplete_target: "input",
                                action: "input->source-data-autocomplete#onInput"
                              },
                              autocomplete: "off" %>
          <ul class="hidden absolute z-10 w-full border rounded mt-1 bg-white max-h-60 overflow-auto shadow-lg"
              data-source-data-autocomplete-target="dropdown">
          </ul>
          <%= form.hidden_field :source_data_id,
                                data: { source_data_autocomplete_target: "hiddenField" } %>
        </div>
      </div>


  <%# mr_character.persisted? checks if mr_character already exists in database %>
  <div class="inline">
    <%= form.submit(
          mr_character.persisted? ? "Update Mushroom Character" : "Create Mushroom Character",
          class: "w-full sm:w-auto rounded-md px-2 py-1 bg-blue-600 hover:bg-blue-500 text-white inline-block font-medium cursor-pointer"
        ) %>
  </div>

<% end %>
